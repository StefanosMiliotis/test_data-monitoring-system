services:
  mosquitto:
    image: eclipse-mosquitto:latest
    ports: 
      - "1883:1883" #mqtt port standard , mapping host port to docker port 
    volumes: 
      - ./mosquitto/mosquitto.conf:/mosquitto/config/mosquitto.conf #config volume - οδηγιες 
  
  db:
    image: timescale/timescaledb:latest-pg18 #timescaledb light για λογους απλοτητας - αποθηκευση μεσα στο dokcer
    environment:
      POSTGRES_USER: postgres #database username 
      POSTGRES_PASSWORD: postgres
      POSTGRES_DB: foo #ονομα βασης που θα μπουν οι πινακες
    ports:
      - "5432:5432" #port standard 
    volumes:
      - ./db_data:/var/lib/postgresql/data #μονιμη αποθηκευση δεδομενων 

  publisher_1:
    build: 
      dockerfile: Dockerfile.publisher #ονομα αρχειου με οδηγιες για τους publishers
      #no ports , στελνει μονο δεδομενα 
    environment:
      MQTT_BROKER: mosquitto #broker ειναι το container mosquitto 
      DEVICE_NAME: sensor_1 #ονομα αισθητηρα 
    depends_on:
      - mosquitto #ξεκιναει publisher μετα απο mosquitto 

  publisher_2:
    build: 
      dockerfile: Dockerfile.publisher #ονομα αρχειου με οδηγιες για τους publishers
      #no ports , στελνει μονο δεδομενα 
    environment:
      MQTT_BROKER: mosquitto #broker ειναι το container mosquitto 
      DEVICE_NAME: sensor_2 #ονομα αισθητηρα 
    depends_on:
      - mosquitto #ξεκιναει publisher μετα απο mosquitto 

  publisher_3:
    build: 
      dockerfile: Dockerfile.publisher #ονομα αρχειου με οδηγιες για τους publishers
      #no ports , στελνει μονο δεδομενα 
    environment:
      MQTT_BROKER: mosquitto #broker ειναι το container mosquitto 
      DEVICE_NAME: sensor_3 #ονομα αισθητηρα 
    depends_on:
      - mosquitto #ξεκιναει publisher μετα απο mosquitto 
